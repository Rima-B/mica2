package obiba.mica;
option java_package = "org.obiba.mica.web.model";
import "Mica.proto";

message QueryDto {
  required int32 from = 1 [default = 0];
  required int32 size = 2 [default = 10];
  required bool detailed = 3 [default = true];
  required FilteredQueryDto filteredQuery = 4;
}

message FilteredQueryDto {
  required BoolFilterQueryDto filter = 1;
}

message BoolFilterQueryDto {
  repeated FilterQueryDto filters = 1;
  optional ParentChildFilterDto parentChildFilter = 2;
}

message ParentChildFilterDto {
  enum Relationship {
    PARENT = 0;
    CHILD = 1;
  }

  required Relationship relationship = 1;
  required string type = 2;
  required FilteredQueryDto filteredQuery = 3;
}

  message FilterQueryDto {
  required string field = 1;
  extensions 1000 to max;
}

message TermsFilterQueryDto {
  repeated string values = 2;

  extend FilterQueryDto {
    optional TermsFilterQueryDto terms = 1000;
  }
}

message RangeConditionDto {
  enum Operator {
    LT = 0;
    LTE = 1;
    GT = 2;
    GTE = 3;
  }

  required Operator op = 1;
  required string value = 2;
}

message RangeFilterQueryDto {

  optional RangeConditionDto from = 1;
  optional RangeConditionDto to = 2;

  extend FilterQueryDto {
    optional RangeFilterQueryDto range = 1001;
  }
}

message QueryResultDto {
  repeated AggregationResultDto aggs = 1;
  required int32 totalHits = 2;

  extensions 1000 to max;
}

message StudyResultDto {
  repeated obiba.mica.StudySummaryDto summaries = 1;
  repeated obiba.mica.StudyDto studies = 2;

  extend QueryResultDto {
    optional StudyResultDto result = 1000;
  }
}

message DatasetVariableResultDto {
  repeated obiba.mica.DatasetVariableResolverDto summaries = 1;
  repeated obiba.mica.DatasetVariableDto variables = 2;
  repeated obiba.mica.DatasetDto datasets = 3;

  extend QueryResultDto {
    optional DatasetVariableResultDto result = 1001;
  }
}

message DatasetsResultDto {
  repeated obiba.mica.DatasetDto datasets = 1;

  extend QueryResultDto {
    optional DatasetsResultDto result = 1002;
  }
}

message StudySummariesResultDto {
  repeated obiba.mica.StudySummaryDto summaries = 1;

  extend QueryResultDto {
    optional StudySummariesResultDto
     result = 1003;
  }
}

message AggregationResultDto {
  required string aggregation = 1;
  extensions 1000 to max;
}

message TermsAggregationResultDto {
  required string key = 1;
  required int32 count = 2;

  extend AggregationResultDto {
    repeated TermsAggregationResultDto terms = 1000;
  }
}

message StatsAggregationResultDto {
  required int64 count = 1;
  required double min = 2;
  required double max = 3;
  required double avg = 4;
  required double sum = 5;

  extend AggregationResultDto {
    optional StatsAggregationResultDto stats = 1001;
  }
}


